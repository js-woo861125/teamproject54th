<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="ks54team01.customer.register.mapper.RegisterMapper">
  
  	<!-- resultMap : 조회 결과를 자바 클래스(domain,dto)와 명시적으로 매핑설정 -->
	<resultMap type="CustomerMember" id="memberResultMap">
		<!-- id : 테이블 pk 컬럼 -->
		<id 	column="members_id" 			property="memberId" />
		<!-- result : 테이블 일반 컬럼 -->
		<result column="members_pw" 			property="memberPw" />
		<result column="members_type" 			property="memberType" />
		<result column="register_date" 			property="memberReisterDate" />
		<result column="revision_date" 			property="memberRevisionDate" />
		<result column="dormant_status" 		property="memberDormantStatus" />
		<result column="withdraw_status" 		property="memberWithdrawStatus" />
		<result column="state_transition_date" 	property="memberStateTransitionDate" />
	</resultMap>
	
	<insert id="addEntEmpMember" parameterType="EntMember">
		/* 입점업체직원정보 등록 */
		INSERT INTO ent_emp
		(ent_emp_id, ent_ceo_no, ent_brno, ent_nm, ent_position, ent_emp_nm, ent_emp_email, ent_emp_phone, register_date, revision_date)
		VALUES
		(#{memberId}, #{entCeoNo}, #{entBrno}, #{entName}, #{entPosition}, #{entEmpName}, #{entEmpEmail}, #{entEmpPhone}, CURDATE(), CURDATE());
	</insert>
	
	<insert id="addEntCeoMember" parameterType="EntMember">
		/* 입점업체대표정보 등록 */
	    INSERT INTO ent_ceo 
	    	(ent_ceo_no, ent_ceo_id, ent_ceo_nm, ent_brno, ent_nm, ent_ceo_addr, ent_ceo_daddr, ent_ceo_email,
	         ent_bank, ent_bank_num, ent_ceo_phone, register_date, revision_date) 
	    VALUES 
	    	(#{entCeoNo}, #{memberId}, #{entCeoName}, #{entBrno}, #{entName}, #{entCeoAddr}, #{entCeoDaddr}, #{entCeoEmail},
	         #{entBank}, #{entBankNum}, #{entCeoPhone}, CURDATE(), CURDATE())
	</insert>
	<!-- <select id="getLastEntCeoNo" parameterType="string">
		/* 입점업체대표코드 자동생성 */
		SELECT 
			MAX(CAST(SUBSTRING(ent_ceo_no, -1) AS UNSIGNED)) 
		FROM 
			ent_ceo;
	</select> -->
	
	<insert id="addCorpMember" parameterType="CustomerMember">
		/* 기업정보 등록 */
		INSERT INTO corp_customer
		(cust_id, corp_brno, corp_nm, register_date, revision_date)
		VALUES
		(#{memberId}, #{corpBrno}, #{corpName}, CURDATE(), CURDATE());
	</insert>
	
	<insert id="addMember" parameterType="CustomerMember">
		/* 일반회원정보 등록 */
		INSERT INTO customer
		(cust_id, cust_nm, cust_brdt, cust_addr, cust_daddr, cust_email, cust_phone, register_date, revision_date)
		VALUES
		(#{memberId}, #{custName}, #{custBrdt}, #{custAddr}, #{custDaddr}, #{custEmail}, #{custPhone}, CURDATE(), CURDATE());
	</insert>
	
	<insert id="addBasicMember" parameterType="CustomerMember">
		/* 공통회원정보 등록 */
		INSERT INTO members
		(members_id, members_pw, members_type, register_date, revision_date, state_transition_date)
		VALUES
		(#{memberId}, #{memberPw}, #{memberType}, CURDATE(), CURDATE(), #{memberStateTransitionDate});
	</insert>
	
  	<select id="getMemberInfoById" parameterType="string" resultMap="memberResultMap">
		/* 회원 정보 조회 */
		SELECT
			members_id, 
			members_pw, 
			members_type, 
			register_date, 
			revision_date, 
			dormant_status, 
			withdraw_status, 
			state_transition_date
		FROM 
			members
		WHERE 
			members_id = #{memberId};		
	</select>
  	
  	<select id="isIdCheck" parameterType="string" resultType="boolean">
		/* 아이디 중복 체크 */
		select 
			count(*)
		from 
			members m
		where 
			m.members_id = #{memberId};
	</select>
  </mapper>